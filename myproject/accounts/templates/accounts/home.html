{% extends 'base.html' %}

{% block content %}
<section class="bg-light py-5">
  <div class="container">
    <div class="row justify-content-center">
      
      <div class="col-12 col-md-10 col-lg-9 col-xl-10"> 
        
        <div class="card border-0 rounded-4 shadow-lg">
          <div class="card-body p-4 p-md-5">
            
            {% if form %}
              <div class="alert alert-warning mb-4 shadow-sm border-warning">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <strong>Action Required:</strong> Please complete your employee profile to access the dashboard.
              </div>
            {% endif %}

            <div class="text-center mb-4">
                <h3 class="h4 fw-bold">
                    {% if form %}Complete Your Profile{% else %}Welcome, {{ user.first_name|default:user.username }}!{% endif %}
                </h3>
                {% if form %}
                    <p class="text-secondary small">Enter or verify your details below</p>
                {% else %}
                    <p class="text-success small">Your profile is complete. You have full access.</p>
                {% endif %}
            </div>

            {% if form %}
            <form method="POST">
              {% csrf_token %}
              
              {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {{ form.non_field_errors }}
                </div>
              {% endif %}

              <div class="row g-4">
                
                {# --- CUSTOM USER FIELDS (PERSONAL) --- #}

                <div class="col-md-6"> 
                  <label for="{{ form.first_name.id_for_label }}" class="form-label fw-semibold">
                    First Name <span class="text-danger">*</span>
                  </label>
                  <input type="text" 
                            class="form-control {% if form.first_name.errors %}is-invalid{% endif %}" 
                            name="{{ form.first_name.name }}" id="{{ form.first_name.id_for_label }}" 
                            placeholder="Enter your First Name" 
                            value="{{ form.first_name.value|default_if_none:'' }}" 
                            required>
                  {% for error in form.first_name.errors %}
                      <div class="invalid-feedback">{{ error }}</div>
                  {% endfor %}
                </div>

                <div class="col-md-6"> 
                  <label for="{{ form.last_name.id_for_label }}" class="form-label fw-semibold">
                    Last Name <span class="text-danger">*</span>
                  </label>
                  <input type="text" 
                            class="form-control {% if form.last_name.errors %}is-invalid{% endif %}" 
                            name="{{ form.last_name.name }}" id="{{ form.last_name.id_for_label }}" 
                            placeholder="Enter your Last Name" 
                            value="{{ form.last_name.value|default_if_none:'' }}" 
                            required>
                  {% for error in form.last_name.errors %}
                      <div class="invalid-feedback">{{ error }}</div>
                  {% endfor %}
                </div>

                <div class="col-md-6"> 
                  <label for="{{ form.Email.id_for_label }}" class="form-label fw-semibold">
                    Email <span class="text-danger">*</span>
                  </label>
                  <input type="email" 
                            class="form-control {% if form.Email.errors %}is-invalid{% endif %}" 
                            name="{{ form.Email.name }}" id="{{ form.Email.id_for_label }}" 
                            placeholder="Enter your Email" 
                            value="{{ form.Email.value|default_if_none:'' }}" 
                            required>
                  {% for error in form.Email.errors %}
                      <div class="invalid-feedback">{{ error }}</div>
                  {% endfor %}
                </div>

                <div class="col-md-6"> 
                  <label for="{{ form.Phone.id_for_label }}" class="form-label fw-semibold">
                    Mobile Number <span class="text-danger">*</span>
                  </label>
                  <input type="tel" 
                            class="form-control {% if form.Phone.errors %}is-invalid{% endif %}" 
                            name="{{ form.Phone.name }}" id="{{ form.Phone.id_for_label }}" 
                            placeholder="Enter your Mobile Number" 
                            value="{{ form.Phone.value|default_if_none:'' }}" 
                            required>
                  {% for error in form.Phone.errors %}
                      <div class="invalid-feedback">{{ error }}</div>
                  {% endfor %}
                </div>

                <div class="col-md-6"> 
                  <label for="{{ form.Gender.id_for_label }}" class="form-label fw-semibold">
                    Gender <span class="text-danger">*</span>
                  </label>
                  {{ form.Gender }} 
                  {% for error in form.Gender.errors %}
                      <div class="invalid-feedback d-block">{{ error }}</div>
                  {% endfor %}
                </div>

                <div class="col-md-6"> 
                  <label for="{{ form.DoB.id_for_label }}" class="form-label fw-semibold">
                    Date of Birth <span class="text-danger">*</span>
                  </label>
                  <input type="date" 
                            class="form-control {% if form.DoB.errors %}is-invalid{% endif %}" 
                            name="{{ form.DoB.name }}" id="{{ form.DoB.id_for_label }}" 
                            value="{{ form.DoB.value|default_if_none:'' }}" 
                            required>
                  {% for error in form.DoB.errors %}
                      <div class="invalid-feedback">{{ error }}</div>
                  {% endfor %}
                </div>
                
                {# --- EMPLOYEE FIELDS (PROFESSIONAL) --- #}

                <div class="col-md-6"> 
                  <label for="{{ form.Dept.id_for_label }}" class="form-label fw-semibold">
                    Department <span class="text-danger">*</span>
                  </label>
                  <input type="text" 
                            class="form-control {% if form.Dept.errors %}is-invalid{% endif %}" 
                            name="{{ form.Dept.name }}" id="{{ form.Dept.id_for_label }}" 
                            placeholder="Enter Department" 
                            value="{{ form.Dept.value|default_if_none:'' }}" 
                            required>
                  {% for error in form.Dept.errors %}
                      <div class="invalid-feedback">{{ error }}</div>
                  {% endfor %}
                </div>

                <div class="col-md-6"> 
                  <label for="{{ form.Grade.id_for_label }}" class="form-label fw-semibold">
                    Grade <span class="text-danger">*</span>
                  </label>
                  <input type="text" 
                            class="form-control {% if form.Grade.errors %}is-invalid{% endif %}" 
                            name="{{ form.Grade.name }}" id="{{ form.Grade.id_for_label }}" 
                            placeholder="Enter Grade" 
                            value="{{ form.Grade.value|default_if_none:'' }}" 
                            required>
                  {% for error in form.Grade.errors %}
                      <div class="invalid-feedback">{{ error }}</div>
                  {% endfor %}
                </div>

                <div class="col-md-6"> 
                  <label for="{{ form.Discipline.id_for_label }}" class="form-label fw-semibold">
                    Discipline <span class="text-danger">*</span>
                  </label>
                  <input type="text" 
                            class="form-control {% if form.Discipline.errors %}is-invalid{% endif %}" 
                            name="{{ form.Discipline.name }}" id="{{ form.Discipline.id_for_label }}" 
                            placeholder="Enter Discipline" 
                            value="{{ form.Discipline.value|default_if_none:'' }}" 
                            required>
                  {% for error in form.Discipline.errors %}
                      <div class="invalid-feedback">{{ error }}</div>
                  {% endfor %}
                </div>

                <div class="col-md-6"> 
                  <label for="{{ form.Floor.id_for_label }}" class="form-label fw-semibold">
                    Floor <span class="text-danger">*</span>
                  </label>
                  <input type="text" 
                            class="form-control {% if form.Floor.errors %}is-invalid{% endif %}" 
                            name="{{ form.Floor.name }}" id="{{ form.Floor.id_for_label }}" 
                            placeholder="Enter Floor" 
                            value="{{ form.Floor.value|default_if_none:'' }}" 
                            required>
                  {% for error in form.Floor.errors %}
                      <div class="invalid-feedback">{{ error }}</div>
                  {% endfor %}
                </div>

                <div class="col-12 mt-4">
                  <div class="form-check">
                    <input class="form-check-input" 
                             type="checkbox" 
                             name="{{ form.Active.name }}" 
                             id="{{ form.Active.id_for_label }}" 
                             {% if form.Active.value %}checked{% endif %}>
                    <label class="form-check-label text-secondary" for="{{ form.Active.id_for_label }}">
                      Active Employee Status
                    </label>
                  </div>
                </div>

                <div class="col-12">
                  <div class="d-grid mt-3">
                    <button class="btn btn-primary btn-lg py-3" type="submit">
                        Save and Continue
                    </button>
                  </div>
                </div>

              </div>
            </form>
            
            {% else %}
            <div class="row g-4 mt-3">
                <div class="col-md-6">
                    <div class="card p-4 shadow-sm h-100 border-primary">
                        <h4 class="fw-bold text-primary"><i class="fas fa-plus-circle me-2"></i> Report a New Issue</h4>
                        <p class="text-secondary">If you are experiencing a technical problem or need assistance, submit a new incident ticket here.</p>
                        <a href="{% url 'create_incident' %}" class="btn btn-primary mt-auto">
                            Submit an Incident
                        </a>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card p-4 shadow-sm h-100 border-secondary">
                        <h4 class="fw-bold text-secondary"><i class="fas fa-list-check me-2"></i> Track Your Tickets</h4>
                        <p class="text-secondary">View the status, history, and details of all incidents you have previously submitted.</p>
                        <a href="{% url 'incident_list' %}" class="btn btn-outline-secondary mt-auto">
                            View My Incidents
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}

          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}