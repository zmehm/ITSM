{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white text-center">
            <h4>Create Incident</h4>
        </div>
        <div class="card-body">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}

                <div class="form-group mb-3">
                    <label for="subsidiary" class="form-label">Subsidiary</label>
                    <input type="text" id="subsidiary" name="subsidiary" class="form-control" required>
                </div>
                <!-- Category Dropdown -->
                <div class="form-group mb-3">
                    <label for="category-select" class="form-label">Category</label>
                    <select id="category-select" name="catID" class="form-select" required>
                        <option value="">Select a Category</option>
                        <option value="1">Hardware</option>
                        <option value="2">Software</option>
                    </select>
                </div>

                <!-- Subcategory Dropdown -->
                <div class="form-group mb-3">
                    <label for="subcategory-select" class="form-label">Subcategory</label>
                    <select id="subcategory-select" name="subcatID" class="form-select" disabled required>
                        <option value="">Select a Category first</option>
                    </select>
                </div>

                <!-- Description Field -->
                <div class="form-group mb-3">
                    <label for="description" class="form-label">Description</label>
                    <textarea id="description" name="description" class="form-control" rows="4" required></textarea>
                </div>

                <!-- Impact Field -->
                <div class="form-group mb-3">
                    <label for="impact" class="form-label">Impact</label>
                    <select id="impact" name="impact" class="form-select" required>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>

                <!-- File Upload Field -->
                <div class="form-group mb-3">
                    <label for="file_upload" class="form-label">Upload File (Optional)</label>
                    <input type="file" id="file_upload" name="file_upload" class="form-control"
                        accept=".jpg, .jpeg, .pdf">
                </div>

                <!-- Submit Button -->
                <div class="form-group mb-3 text-center">
                    <button type="submit" class="btn btn-success w-100">Submit Incident</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Bootstrap JS and Popper.js (from CDN) -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"
    integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y"
    crossorigin="anonymous"></script>

<!-- Custom JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const categorySelect = document.getElementById('category-select');
        const subcategorySelect = document.getElementById('subcategory-select');

        // Define subcategories for "Hardware"
        const hardwareSubcategories = [
            { id: 1, name: "Laptop" },
            { id: 2, name: "Desktop" }
        ];

        // Define subcategories for "Software"
        const softwareSubcategories = [
            { id: 3, name: "Operating System" },
            { id: 4, name: "Application" }
        ];

        // Event listener for category selection change
        categorySelect.addEventListener('change', function () {
            const categoryId = this.value;

            // Reset and disable subcategory dropdown
            subcategorySelect.innerHTML = '<option value="">Loading...</option>';
            subcategorySelect.disabled = true;

            if (categoryId) {
                let subcategories = [];

                // Load subcategories based on the category selection
                if (categoryId == "1") {  // Hardware
                    subcategories = hardwareSubcategories;
                } else if (categoryId == "2") {  // Software
                    subcategories = softwareSubcategories;
                }

                // Populate subcategory dropdown
                subcategorySelect.innerHTML = '<option value="">Select a Subcategory</option>';
                subcategories.forEach(subcat => {
                    const option = document.createElement('option');
                    option.value = subcat.id;
                    option.textContent = subcat.name;
                    subcategorySelect.appendChild(option);
                });

                subcategorySelect.disabled = false;
            } else {
                subcategorySelect.innerHTML = '<option value="">Select a Category first</option>';
                subcategorySelect.disabled = true;
            }
        });
    });
</script>

{% endblock %}